name: Create New Release
on:
  workflow_dispatch:
    inputs:
      autotag:
        description: "Automatically bump tag version"
        default: false
        type: boolean
      overwrite-existing:
        description: "Overwrite existing release for the latest tag if exists"
        default: false
        type: boolean
jobs:
  tag-and-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Create empty commit
        uses: velocibear/create-empty-commit@v1.0.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          email: soumyaranjan1812@gmail.com
          name: Soumya Ranjan Patnaik
          message: Build Release
      - name: Bump version and push tag
        id: tag_version
        uses: mathieudutour/github-tag-action@v6.1
        if: ${{ inputs.autotag }}
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
      - name: Create a GitHub release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ steps.tag_version.outputs.new_tag }}
          name: Release ${{ steps.tag_version.outputs.new_tag }}
          body: ${{ steps.tag_version.outputs.changelog }}
          removeArtifacts: ${{ inputs.overwrite-existing }}
          draft: true
  build:
    needs: tag-and-release
    uses: karya-inc/worker-desktop-release/.github/workflows/build-release.yml@main
    with:
      release: ${{ startsWith(github.ref, 'refs/tags/v') }}
    secrets:
      src_token: ${{ secrets.KARYA_SERVER_TOKEN }}
